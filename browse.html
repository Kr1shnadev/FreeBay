<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaanSetu - Browse Donations</title>
    <link rel="stylesheet" href="browse.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="logo">
                    <img src="DaanSetu__2_-removebg-preview.png" alt="DaanSetu" style="width: 80px; height: auto;">
                    <span>DaanSetu</span>
                </div>
                <div class="search-bar">
                    <div class="location-select">
                        <i class="fas fa-map-marker-alt"></i>
                        <select id="locationSelect">
                            <option value="all">All India</option>
                            <option value="andheri east">Andheri East</option>
                            <option value="powai">Powai</option>
                            <option value="mumbai">Mumbai</option>
                            <option value="delhi">Delhi</option>
                            <option value="andheri">Andheri</option>
                            <option value="hyderabad">Hyderabad</option>
                            <option value="chennai">Chennai</option>
                            <option value="panaji">Panaji</option>
                            <option value="kolkata">Kolkata</option>
                            <option value="ranchi">Ranchi</option>
                            <option value="thiruvananthapuram">Thiruvananthapuram</option>
                        </select>
                    </div>
                    <div class="search-input">
                        <input type="text" id="searchInput" placeholder="Search donations...">
                        <button class="search-btn" id="searchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="nav-right">
                <a href="dashboard.html" class="nav-icon" title="Your Dashboard">
                    <i class="far fa-user"></i>
                </a>
                <a href="donate.html" class="donate-btn">
                    <i class="fas fa-plus"></i>
                    Donate Item
                </a>
            </div>
        </div>
    </nav>

    <div class="categories-bar">
        <div class="categories-container">
            <a href="#" class="category-btn active" data-category="all">
                <i class="fas fa-border-all"></i>
                All Categories
            </a>
            <a href="#" class="category-btn" data-category="books">
                <i class="fas fa-book"></i>
                Books
            </a>
            <a href="#" class="category-btn" data-category="clothing">
                <i class="fas fa-tshirt"></i>
                Clothing
            </a>
            <a href="#" class="category-btn" data-category="electronics">
                <i class="fas fa-laptop"></i>
                Electronics
            </a>
            <a href="#" class="category-btn" data-category="furniture">
                <i class="fas fa-couch"></i>
                Furniture
            </a>
            <a href="#" class="category-btn" data-category="sports">
                <i class="fas fa-bicycle"></i>
                Sports
            </a>
            <a href="#" class="category-btn" data-category="toys">
                <i class="fas fa-puzzle-piece"></i>
                Toys
            </a>
            <a href="#" class="category-btn" data-category="music">
                <i class="fas fa-music"></i>
                Music
            </a>
        </div>
    </div>

    <main class="browse-content">
        <div class="filters-sidebar">
            <h3>Filters</h3>
            <div class="filter-group">
                <h4>Condition</h4>
                <label class="filter-option">
                    <input type="checkbox" name="condition" value="like new">
                    Like New
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="condition" value="good">
                    Good
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="condition" value="fair">
                    Fair
                </label>
            </div>

        </div>

        <div class="donations-grid">
            <!-- Featured Section -->
            <div class="featured-section">
                <h2>Featured Donations</h2>
                <div class="featured-items">
                    <div class="donation-card featured" data-category="furniture" data-location="andheri east" data-condition="good">
                        <div class="card-image">
                            <img src="images\studytable.png" alt="Study Table">
                            <span class="tag">Furniture</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Study Table with Chair</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Andheri East</p>
                            <p class="description">Wooden study table with comfortable chair, great condition</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card featured" data-category="books" data-location="powai" data-condition="like new">
                        <div class="card-image">
                            <img src="images\book.png" alt="Books">
                            <span class="tag">Books</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Engineering Textbooks Set</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Powai</p>
                            <p class="description">Complete set of engineering books, like new condition</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Like New</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <!-- Start of moved donation cards from Recent Donations -->
                    <div class="donation-card" data-category="electronics" data-location="mumbai" data-condition="good">
                        <div class="card-image">
                            <img src="images/laptop.png" alt="Laptop">
                            <span class="tag">Electronics</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>HP Laptop</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Mumbai</p>
                            <p class="description">Core i5, 8GB RAM, 256GB SSD, good battery life</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="sports" data-location="delhi" data-condition="good">
                        <div class="card-image">
                            <img src="images/bike.png" alt="Bicycle">
                            <span class="tag">Sports</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Mountain Bike</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Delhi</p>
                            <p class="description">21-speed mountain bike, recently serviced</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="clothing" data-location="andheri" data-condition="like new">
                        <div class="card-image">
                            <img src="images/winter.png" alt="Clothes">
                            <span class="tag">Clothing</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Winter Clothes Set</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Andheri</p>
                            <p class="description">Set of winter jackets and sweaters, size M</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Like New</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="music" data-location="hyderabad" data-condition="fair">
                        <div class="card-image">
                            <img src="images/guitar.png" alt="Guitar">
                            <span class="tag">Music</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Acoustic Guitar</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Hyderabad</p>
                            <p class="description">Yamaha acoustic guitar with bag and picks</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Fair</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="furniture" data-location="chennai" data-condition="good">
                        <div class="card-image">
                            <img src="images/sofa.png" alt="Sofa">
                            <span class="tag">Furniture</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>3-Seater Sofa</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Chennai</p>
                            <p class="description">Comfortable fabric sofa, beige color</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="toys" data-location="panaji" data-condition="good">
                        <div class="card-image">
                            <img src="images/lego.png" alt="Toys">
                            <span class="tag">Toys</span>
                            <button class="favorite-btn">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="card-content">
                            <h3>LEGO Collection</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Panaji</p>
                            <p class="description">Various LEGO sets with instruction manuals</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="electronics" data-location="kolkata" data-condition="good">
                        <div class="card-image">
                            <img src="images/lcd.png" alt="Monitor">
                            <span class="tag">Electronics</span>
                            <button class="favorite-btn">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="card-content">
                            <h3>24" LCD Monitor</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Kolkata</p>
                            <p class="description">Full HD monitor with HDMI and VGA ports</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="sports" data-location="powai" data-condition="fair">
                        <div class="card-image">
                            <img src="images/cricket.png" alt="Cricket Kit">
                            <span class="tag">Sports</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Cricket Kit</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Powai</p>
                            <p class="description">Complete cricket set with bat, pads, and helmet</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Fair</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="furniture" data-location="ranchi" data-condition="like new">
                        <div class="card-image">
                            <img src="images/bookshelf.png" alt="Bookshelf">
                            <span class="tag">Furniture</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Wooden Bookshelf</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Ranchi</p>
                            <p class="description">5-tier wooden bookshelf, easy to assemble</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Like New</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <div class="donation-card" data-category="electronics" data-location="thiruvananthapuram" data-condition="good">
                        <div class="card-image">
                            <img src="images/phone.png" alt="Smartphone">
                            <span class="tag">Electronics</span>
                            
                        </div>
                        <div class="card-content">
                            <h3>Samsung Galaxy Phone</h3>
                            <p class="location"><i class="fas fa-map-marker-alt"></i> Thiruvananthapuram</p>
                            <p class="description">4GB RAM, 64GB storage, with charger and case</p>
                            <div class="card-footer">
                                <span class="condition"><i class="fas fa-star"></i> Good</span>
                                <a href="#" class="contact-btn"><i class="fab fa-whatsapp"></i> Contact</a>
                            </div>
                        </div>
                    </div>
                    <!-- End of moved donation cards from Recent Donations -->
                </div>
            </div>

            <!-- Recent Donations -->
            <div class="recent-donations">
                <h2>Recent Donations</h2>
                <div class="donations-container" id="recent-donations-container">
                    <div class="loading-message">Loading recent donations...</div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#">About</a>
                <a href="#">Safety</a>
                <a href="#">Support</a>
                <a href="#">Contact</a>
            </div>
            <div class="footer-social">
                <a href="https://www.instagram.com/accounts/login/?hl=en" class="social-link">Instagram</a>
                <a href="https://www.facebook.com/?locale2=en_GB&_rdr" class="social-link">Facebook</a>
                <a href="https://x.com/i/flow/login?lang=en" class="social-link">X</a>
            </div>
        </div>
    </footer>
    <script src="filter.js"></script>
    <script src="donation-card.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Auth check: redirect to login.html if not logged in
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Firebase to be initialized
            var checkAuthInterval = setInterval(function() {
                if (window.firebase && firebase.auth) {
                    clearInterval(checkAuthInterval);
                    firebase.auth().onAuthStateChanged(function(user) {
                        if (!user) {
                            window.location.href = 'login.html';
                        }
                    });
                }
            }, 100);
        });
    </script>
    
    <script>
        // Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCu10UwrAtEucO340SJ8Pm4G3rBL88w6Io",
            authDomain: "freebay-35764.firebaseapp.com",
            projectId: "freebay-35764",
        };
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        
        // Load recent donations
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentDonations();
        });
        
        function loadRecentDonations() {
            const container = document.getElementById('recent-donations-container');
            container.innerHTML = '<div class="loading-message">Loading recent donations...</div>';
            
            db.collection('donations')
                .orderBy('timestamp', 'desc')
                .limit(6)
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        container.innerHTML = '<div class="no-donations-message">No recent donations at this time.</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    snapshot.forEach(doc => {
                        const donation = doc.data();
                        const donationCard = createDonationCard(donation, doc.id);
                        container.appendChild(donationCard);
                    });
                })
                .catch(error => {
                    console.error("Error loading recent donations:", error);
                    container.innerHTML = '<div class="error-message">Error loading donations. Please try again later.</div>';
                });
        }
        
        function createDonationCard(donation, donationId) {
            const card = document.createElement('div');
            card.className = 'donation-card';
            card.dataset.category = donation.item.category || 'other';
            card.dataset.location = donation.delivery ? (donation.delivery.address || 'Unknown') : 'Unknown';
            card.dataset.condition = donation.item.condition || 'good';
            card.dataset.id = donationId;
            
            // Default image based on category
            let imageSrc = 'images/default.png';
            if (donation.item.category === 'furniture') imageSrc = 'images/sofa.png';
            if (donation.item.category === 'electronics') imageSrc = 'images/laptop.png';
            if (donation.item.category === 'books') imageSrc = 'images/book.png';
            if (donation.item.category === 'clothing') imageSrc = 'images/winter.png';
            if (donation.item.category === 'sports') imageSrc = 'images/bike.png';
            if (donation.item.category === 'toys') imageSrc = 'images/lego.png';
            if (donation.item.category === 'music') imageSrc = 'images/guitar.png';
            
            card.innerHTML = `
                <div class="card-image">
                    <img src="${imageSrc}" alt="${donation.item.name}">
                    <span class="tag">${donation.item.category || 'Other'}</span>
                    <button class="favorite-btn">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
                <div class="card-content">
                    <h3>${donation.item.name}</h3>
                    <p class="location"><i class="fas fa-map-marker-alt"></i> ${donation.delivery ? (donation.delivery.address || 'Unknown') : 'Unknown'}</p>
                    <p class="description">${donation.item.notes || 'No description available'}</p>
                    <div class="card-footer">
                        <span class="condition"><i class="fas fa-star"></i> ${donation.item.condition || 'Good'}</span>
                        <a href="#" class="contact-btn" data-donor-email="${donation.userEmail}"><i class="fab fa-whatsapp"></i> Contact</a>
                    </div>
                </div>
            `;

            // Show reserved badge and disable contact if reserved
            if (donation.status === 'reserved' || donation.reserved) {
                const badge = document.createElement('div');
                badge.textContent = 'Reserved';
                badge.style.position = 'absolute';
                badge.style.top = '12px';
                badge.style.right = '12px';
                badge.style.background = '#ffb300';
                badge.style.color = '#fff';
                badge.style.padding = '5px 12px';
                badge.style.borderRadius = '18px';
                badge.style.fontWeight = 'bold';
                badge.style.fontSize = '0.95em';
                badge.style.boxShadow = '0 2px 8px #ffe082';
                card.querySelector('.card-image').appendChild(badge);
                // Disable contact button
                const contactBtn = card.querySelector('.contact-btn');
                contactBtn.textContent = 'Reserved';
                contactBtn.style.background = '#bdbdbd';
                contactBtn.style.cursor = 'not-allowed';
                contactBtn.style.pointerEvents = 'none';
            }

            // Make the card clickable
            card.style.cursor = 'pointer';
            card.addEventListener('click', function(e) {
                // Don't trigger if clicking the favorite button or contact button
                if (e.target.closest('.favorite-btn') || e.target.closest('.contact-btn')) {
                    return;
                }
                
                // Get card details for URL parameters
                const title = donation.item.name;
                const category = donation.item.category || 'Other';
                const condition = donation.item.condition || 'Good';
                const location = donation.delivery ? (donation.delivery.address || 'Unknown') : 'Unknown';
                const description = donation.item.notes || 'No description available';
                
                // Create URL with parameters
                const params = new URLSearchParams({
                    title: title,
                    category: category,
                    condition: condition,
                    location: location,
                    description: description,
                    image: imageSrc,
                    id: donationId
                });
                
                // Navigate to details page
                window.location.href = `donation-details.html?${params.toString()}`;
            });
            
            return card;
        }
    </script>
</body>
</html>
